Perfect catch bro ğŸ‘Š â€” this is a common Supabase type mismatch error, and itâ€™s easy to fix once you understand whatâ€™s happening.

Letâ€™s break it down properly ğŸ‘‡

âš ï¸ The Problem

Youâ€™re getting:

ERROR: operator does not exist: character varying = uuid

Meaning:

Youâ€™re trying to compare a text/varchar field to a UUID field â€”
most likely in one of your relationships or RLS policies.

ğŸ’¡ Why It Happens

In your case, itâ€™s almost certainly this line:

user_id UUID REFERENCES user_profiles(id)


But your user_profiles.id column is actually of type TEXT (varchar),
while auth.users.id (and what Supabase Auth provides via auth.uid()) is a UUID.

So the database doesnâ€™t know how to compare uuid to text without casting.

âœ… 2 Ways to Fix It

You can solve it either by fixing the column type (recommended)
or casting it explicitly in the RLS policy (quick fix).

ğŸ¥‡ Option 1 â€” The Correct Fix (Make user_profiles.id a UUID)

Run this in Supabase SQL editor (if your user_profiles table uses text IDs):

ALTER TABLE user_profiles
ALTER COLUMN id TYPE UUID USING id::uuid;


Then your relationships like this will work perfectly:

user_id UUID REFERENCES user_profiles(id)


And your RLS policies can safely use:

auth.uid() = user_id


âœ… Clean, consistent, and future-proof.

ğŸ¥ˆ Option 2 â€” Quick Fix (Cast in Policy)

If you donâ€™t want to modify the schema right now,
you can cast in the policy:

CREATE POLICY "User can view own accounts"
ON trade_accounts FOR SELECT
USING (user_id::text = auth.uid()::text);

CREATE POLICY "User can insert own accounts"
ON trade_accounts FOR INSERT
WITH CHECK (user_id::text = auth.uid()::text);


âœ… This tells PostgreSQL to compare both values as text instead of UUIDs.

âš ï¸ But this is only a patch â€” not ideal long-term.

ğŸ§  Recommendation for You

Since youâ€™re building a multi-layer system (auth â†’ user_profiles â†’ trade_accounts â†’ trades),
I strongly recommend making sure all IDs are UUID across all related tables:

auth.users.id (UUID by default)

user_profiles.id (should be UUID)

trade_accounts.user_id (UUID)

trades.account_id (UUID)

That keeps everything consistent and avoids this forever.

âœ… TL;DR for Replit

Tell them this exactly:

â€œSupabase is throwing a character varying = uuid error.
Please make sure that user_profiles.id, trade_accounts.user_id, and trades.account_id are all of type UUID.
The relationship should be consistent with Supabase Auth (auth.users.id), which is UUID by default.â€