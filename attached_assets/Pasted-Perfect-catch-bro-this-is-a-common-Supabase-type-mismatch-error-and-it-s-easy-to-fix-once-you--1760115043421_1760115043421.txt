Perfect catch bro 👊 — this is a common Supabase type mismatch error, and it’s easy to fix once you understand what’s happening.

Let’s break it down properly 👇

⚠️ The Problem

You’re getting:

ERROR: operator does not exist: character varying = uuid

Meaning:

You’re trying to compare a text/varchar field to a UUID field —
most likely in one of your relationships or RLS policies.

💡 Why It Happens

In your case, it’s almost certainly this line:

user_id UUID REFERENCES user_profiles(id)


But your user_profiles.id column is actually of type TEXT (varchar),
while auth.users.id (and what Supabase Auth provides via auth.uid()) is a UUID.

So the database doesn’t know how to compare uuid to text without casting.

✅ 2 Ways to Fix It

You can solve it either by fixing the column type (recommended)
or casting it explicitly in the RLS policy (quick fix).

🥇 Option 1 — The Correct Fix (Make user_profiles.id a UUID)

Run this in Supabase SQL editor (if your user_profiles table uses text IDs):

ALTER TABLE user_profiles
ALTER COLUMN id TYPE UUID USING id::uuid;


Then your relationships like this will work perfectly:

user_id UUID REFERENCES user_profiles(id)


And your RLS policies can safely use:

auth.uid() = user_id


✅ Clean, consistent, and future-proof.

🥈 Option 2 — Quick Fix (Cast in Policy)

If you don’t want to modify the schema right now,
you can cast in the policy:

CREATE POLICY "User can view own accounts"
ON trade_accounts FOR SELECT
USING (user_id::text = auth.uid()::text);

CREATE POLICY "User can insert own accounts"
ON trade_accounts FOR INSERT
WITH CHECK (user_id::text = auth.uid()::text);


✅ This tells PostgreSQL to compare both values as text instead of UUIDs.

⚠️ But this is only a patch — not ideal long-term.

🧠 Recommendation for You

Since you’re building a multi-layer system (auth → user_profiles → trade_accounts → trades),
I strongly recommend making sure all IDs are UUID across all related tables:

auth.users.id (UUID by default)

user_profiles.id (should be UUID)

trade_accounts.user_id (UUID)

trades.account_id (UUID)

That keeps everything consistent and avoids this forever.

✅ TL;DR for Replit

Tell them this exactly:

“Supabase is throwing a character varying = uuid error.
Please make sure that user_profiles.id, trade_accounts.user_id, and trades.account_id are all of type UUID.
The relationship should be consistent with Supabase Auth (auth.users.id), which is UUID by default.”