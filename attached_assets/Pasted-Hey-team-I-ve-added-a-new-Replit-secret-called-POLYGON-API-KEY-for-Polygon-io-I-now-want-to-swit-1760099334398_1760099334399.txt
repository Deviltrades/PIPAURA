Hey team üëã
I‚Äôve added a new Replit secret called POLYGON_API_KEY for Polygon.io.
I now want to switch all Yahoo Finance (yfinance / yf.download()) data calls to Polygon.io‚Äôs REST API so my bias scoring system uses clean institutional-grade data instead of web-scraped data.

Here‚Äôs what to do:

1Ô∏è‚É£ Remove all Yahoo Finance calls (yfinance.download or yf.Ticker).

2Ô∏è‚É£ Add a new helper function to fetch data from Polygon:

import os
import requests
from datetime import datetime, timedelta

POLYGON_API_KEY = os.getenv("POLYGON_API_KEY")

def get_polygon_price(ticker, days=7):
    """
    Fetch daily closing prices for FX, indices, or metals using Polygon.io
    Example tickers:
      FX: 'C:EURUSD', 'C:XAUUSD'
      Index: 'I:SPX', 'I:DXY'
    """
    end_date = datetime.utcnow()
    start_date = end_date - timedelta(days=days)
    url = (
        f"https://api.polygon.io/v2/aggs/ticker/{ticker}/range/1/day/"
        f"{start_date.date()}/{end_date.date()}?adjusted=true&sort=asc&apiKey={POLYGON_API_KEY}"
    )

    r = requests.get(url)
    data = r.json()
    if "results" not in data or not data["results"]:
        return None

    closes = [bar["c"] for bar in data["results"]]
    return closes[-1], closes[0]  # latest close, oldest close

def get_percent_change(ticker):
    """Return % change over last 7 days"""
    prices = get_polygon_price(ticker)
    if not prices:
        return 0
    latest, oldest = prices
    return round(((latest - oldest) / oldest) * 100, 2)


3Ô∏è‚É£ Update all scoring logic to use get_percent_change() instead of any yf.download() logic.

Example:

dxy_change = get_percent_change("I:DXY")
spx_change = get_percent_change("I:SPX")
gold_change = get_percent_change("C:XAUUSD")
eurusd_change = get_percent_change("C:EURUSD")


4Ô∏è‚É£ Keep all scoring rules the same, just feed them the new Polygon data instead of Yahoo data.

5Ô∏è‚É£ Test the output by running:

python main.py


and verify that the fundamental_bias, currency_scores, and index_bias tables populate correctly.

‚úÖ The new system should now fetch data from Polygon.io (using my API key), compute weekly % changes, and update Supabase as before ‚Äî just with cleaner, more reliable data.